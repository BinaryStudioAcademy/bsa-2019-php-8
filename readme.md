# Binary Studio Academy 2019 PHP

## Домашнее задание Laravel auth

### Цель
Ознакомиться с механизмами аутентификации и авторизации в Laravel.

### Установка
Установка показана в рабочем окружении OS Linux:
```
git clone git@github.com:BinaryStudioAcademy/bsa-2018-php-9.git
cd bsa-2018-php-9
composer install
cp .env.example .env
php artisan key:generate
```

### Подготовка
1. Добавить entity Product и миграцию с полями id, name, price, user_id.
2. Создать по роуту "/" главную страницу, содержащую текст: "Marketplace".

### Задание 1
Добавить возможность регистрации новых пользователей и аутентификации с помощью email и password.

1. После аутентификации показывать пользователю страницу со списком товаров /products.
2. Закрыть доступ ко всем страницам, кроме главной для пользователей, не прошедших аутентификацию.

### Задание 2
Добавить возможность аутентификации через социальную сеть или сервис, например, Фейсбук (Socialite, SocialiteProviders, etc.)
Для этого нужно будет зарегистрировать приложение на используемом ресурсе и использовать предоставленные ключи внутри .env Laravel приложения.

### Задание 3
Реализовать механизм авторизации с помощью ролей. 

- Ролей должно быть 2: обычный пользователь и администратор.
- Для хранения роли нужно изменить миграцию для таблицы [users]: добавить флаг is_admin.
- Права доступа:
    - Пользователь должен иметь доступ к страницам списка товаров и отдельного товара.
    - Пользователь должен видеть контролы для редактирования, удаления своего товара, а так же добавления нового.
    - Пользователь не должен иметь доступа к соответствующим действиям(добавление, обновление, удаление) для товара другого пользователя.
    - Администратор должен видеть контролы для редактирования, удаления любого товара, а так же добавление нового и иметь доступ к соответствующим действиям.
    - В случае попытки неавторизованного доступа на любую из страниц - перенаправлять на (/login).
- Контроль прав доступа нужно реализовать в классах Policy.
- Проверка критерия предоставления доступа должна происходить в методах класса полиси.
То есть в контроллерах в итоге должна быть проверка типа
```
if (Gate::denies(‘update', $product)) ...
```

вместо
```
if (Gate::denies(‘isAdmin', $product)) ...
```

### Запуск тестов

#### Локально
Допишите порт в .env
```
APP_URL=http://localhost:8000
```
Запустите веб сервер
```
php artisan serve --port=8080
```
Запустите тесты
```
php artisan dusk
```

#### Запуск тестов c Homestead
Зайдите на виртуальную машину через ssh из папки, где установлен Homestead
```
vagrant ssh
```

Перейдите в директорию проекта и запустите
```
php artisan serve --host=192.168.10.10 --port=8080
```

Установите в '.env' строку
```
APP_URL=http://192.168.10.10:8080
```

Теперь можно запустить тесты.
```
php artisan dusk
```

см. [https://laravel.com/docs/5.8/dusk](https://laravel.com/docs/5.8/dusk)

### Дополнительно
Примеры из лекции доступны здесь: [https://github.com/Antarus66/Auth-samples](https://github.com/Antarus66/Auth-samples)
